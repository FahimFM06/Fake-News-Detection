# -*- coding: utf-8 -*-
"""3_Result.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1AhjvBlGROuZrDImb2fGSemp8ETwYVDiA
"""

# pages/3_Result.py
# ============================================================
# Page 3: Result Page (show label + confidence + details)
# ============================================================

import base64
import os
import streamlit as st

st.set_page_config(page_title="Result - Fake News Detection", layout="wide")

def set_background(image_path: str):
    """
    Sets a background image if it exists; otherwise uses a clean gradient.
    """
    if os.path.exists(image_path):
        with open(image_path, "rb") as f:
            data = f.read()
        b64 = base64.b64encode(data).decode()
        st.markdown(
            f"""
            <style>
            .stApp {{
                background: url("data:image/png;base64,{b64}") no-repeat center center fixed;
                background-size: cover;
            }}
            .content-card {{
                background: rgba(255, 255, 255, 0.90);
                padding: 24px;
                border-radius: 16px;
                max-width: 1100px;
                margin: 0 auto;
                box-shadow: 0 8px 26px rgba(0,0,0,0.12);
            }}
            .badge {{
                display: inline-block;
                padding: 10px 14px;
                border-radius: 999px;
                font-weight: 700;
                letter-spacing: 0.3px;
            }}
            .badge-fake {{
                background: rgba(239, 68, 68, 0.15);
                color: rgb(185, 28, 28);
                border: 1px solid rgba(239, 68, 68, 0.35);
            }}
            .badge-real {{
                background: rgba(34, 197, 94, 0.15);
                color: rgb(21, 128, 61);
                border: 1px solid rgba(34, 197, 94, 0.35);
            }}
            </style>
            """,
            unsafe_allow_html=True,
        )
    else:
        st.markdown(
            """
            <style>
            .stApp {
                background: linear-gradient(135deg, #0f172a 0%, #0b1220 45%, #111827 100%);
            }
            .content-card {
                background: rgba(255, 255, 255, 0.92);
                padding: 24px;
                border-radius: 16px;
                max-width: 1100px;
                margin: 0 auto;
                box-shadow: 0 8px 26px rgba(0,0,0,0.18);
            }
            .badge {
                display: inline-block;
                padding: 10px 14px;
                border-radius: 999px;
                font-weight: 700;
                letter-spacing: 0.3px;
            }
            .badge-fake {
                background: rgba(239, 68, 68, 0.15);
                color: rgb(185, 28, 28);
                border: 1px solid rgba(239, 68, 68, 0.35);
            }
            .badge-real {
                background: rgba(34, 197, 94, 0.15);
                color: rgb(21, 128, 61);
                border: 1px solid rgba(34, 197, 94, 0.35);
            }
            </style>
            """,
            unsafe_allow_html=True,
        )

# Optional: place an image at assets/bg_result.png
set_background("assets/bg_result.png")

# Session defaults
if "input_text" not in st.session_state:
    st.session_state["input_text"] = ""
if "prediction" not in st.session_state:
    st.session_state["prediction"] = None

st.markdown('<div class="content-card">', unsafe_allow_html=True)
st.title("Result")

pred = st.session_state.get("prediction", None)
text = st.session_state.get("input_text", "")

if pred is None:
    st.warning("No prediction found. Please go to the **Input** page, paste text, and click **Predict**.")
    st.markdown("</div>", unsafe_allow_html=True)
    st.stop()

label = int(pred["label"])
p_fake, p_real = float(pred["probs"][0]), float(pred["probs"][1])

# Decide display label
if label == 0:
    label_name = "FAKE (0)"
    badge_class = "badge badge-fake"
else:
    label_name = "REAL (1)"
    badge_class = "badge badge-real"

# Big result badge
st.markdown(f'<div class="{badge_class}">Prediction: {label_name}</div>', unsafe_allow_html=True)

# Confidence metrics
col1, col2, col3 = st.columns([1, 1, 2])
with col1:
    st.metric("FAKE Probability", f"{p_fake:.3f}")
with col2:
    st.metric("REAL Probability", f"{p_real:.3f}")
with col3:
    st.write("Confidence (Predicted Class)")
    confidence = max(p_fake, p_real)
    st.progress(min(max(confidence, 0.0), 1.0))

st.divider()

# Input text (collapsible)
with st.expander("Show input text"):
    st.write(text)

st.divider()

# Helpful note
st.info(
    "This output is a model prediction based on patterns in the training data. "
    "For best practice, use this as an assistive signalâ€”not as the only decision factor."
)

# Actions
col_a, col_b = st.columns([1, 1])
with col_a:
    if st.button("Try Another Text"):
        st.session_state["prediction"] = None
        st.session_state["input_text"] = ""
        st.success("Cleared. Go back to the Input page from the sidebar.")
with col_b:
    if st.button("Keep Text, Clear Result"):
        st.session_state["prediction"] = None
        st.success("Result cleared. You can re-run prediction from the Input page.")

st.markdown("</div>", unsafe_allow_html=True)